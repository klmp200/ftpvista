{% load custom_filters %}
{% load url from future %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>FTPVista 3.0</title>
    
    <link rel="search" type="application/opensearchdescription+xml" title="ftpvista" href="{{ base_url }}{% url 'static' 'resources/search_engine.xml' %}" />
        <link href="{% url 'static' 'css/jquery.treetable.css' %}" type="text/css" rel="stylesheet" />
        <link href="{% url 'static' 'css/jquery.multiselect.css' %}" type="text/css" rel="stylesheet" />
        <link href="{% url 'static' 'css/jquery-ui-1.10.4.custom.css' %}" type="text/css" rel="stylesheet" />
        <link href="{% url 'static' 'css/global.css' %}" type="text/css" rel="stylesheet" />
        <script src="{% url 'static' 'js/jquery-1.10.2.min.js' %}" type="text/javascript"></script>
        <script src="{% url 'static' 'js/jquery-ui-1.10.4.custom.min.js' %}" type="text/javascript"></script>
        <script src="{% url 'static' 'js/jquery.multiselect.min.js' %}" type="text/javascript"></script>
</head>
<body>
    <script type="text/javascript">
        function addSearchProvider(){
            window.external.AddSearchProvider('{{ base_url }}{% url "static" "resources/search_engine.xml" %}');
        };
        
        $(document).ready(function() {
            //Create tabs
            $("#tabs").tabs();

            //Show/hide advanced option pane in each tab
            $(".plus_sign").click(function(){
                var sTxt = ' Filtres';
                var cur_pane = $(this);
                cur_pane.next(".advanced_pane").toggle("fast");
                if (cur_pane.html().indexOf('+') != -1)
                    cur_pane.html("-" + sTxt);
                else
                    cur_pane.html("+" + sTxt);
                //To avoid the execution of the # in the href
                return false;
            });
            
            if (window.external){
                if ('AddSearchProvider' in window.external) {
                    $("#summary").append("<span style=\"float:right;\"><a title=\"Add me !\" href=\"javascript:addSearchProvider();\">FTPVista dans ton navigateur !</a></span>")
                }
            }
            
            // Make visible a clicked row
            $("#browser tbody tr").mousedown(function() {
                $("tr.ui-state-highlight").removeClass("ui-state-highlight"); // Deselect currently selected rows
                $(this).addClass("ui-state-highlight");
            });

            // Make sure row is selected when span is clicked
            $("#browser tbody tr span").mousedown(function() {
                $(this).parents("tr:first").trigger("mousedown");
            });

            //Custom Multiselect
            $(".ft").multiselect({
                checkAllText: 'Tous',
                uncheckAllText: 'Aucun',
                noneSelectedText: 'Tous les fichiers',
                selectedList: 5,
                height: 'auto',
                minWidth: 345
            });

            // Refresh server statuses in ajax
            var checkservers = function(){
                $.post(
                    "{% url 'online' %}",
                    function(data){
                        $("#server-list").html(data);
                    }
                );
                setTimeout(checkservers, 120000); //every 2 minutes
            };
            setTimeout(checkservers, 120000); //every 2 minutes
        });
    </script>
    <div id="header">
        <h1>FTPVista</h1>
    </div>
    <div id="summary"><span>{{ nb_files }} fichiers - Total : {{ files_size|filesizeformat2 }}</span></div>
    <div id="search">
            <form method="get" action="{% url 'search' %}">
            <div id="tabs">
                <!-- the tabs -->
                <ul class="tabs">
                    <li><a id="t1" href="#search">Recherche</a></li>
                    <li><a id="t2" href="#server-list">Liste des serveurs</a></li>
                    <li><a id="t3" href="#last">Afficher les derniers fichiers</a></li>
                </ul>
                
                <!-- tab "panes" -->
                <div id="search" class="pane">
                    <p>
                        <input type="text" id="s" name="s" value="{{ query }}" />
                        <input type="submit" value="Rechercher" />
                    </p>
                    
                    <a href="#" class="plus_sign">- Filtres</a>
                    <div class="advanced_pane">
                        <hr/>
                        {{ form.ft.label_tag }} {{ form.ft }}<br/>
                        {{ form.os }} {{ form.os.label_tag }}
                    </div>
                </div>
                <div id="server-list" class="pane">
                    {% include "online.html" %}
                </div>
                <div id="last" class="pane">
                    <a href="#" class="plus_sign">-</a>
                    <div class="advanced_pane">
                        <select id="ft2" name="ft2" multiple="multiple" size="5" class="ft">
                        {% for filterFileType2 in aFilterFileTypes2 %}
                            {% autoescape off %}
                            <option value="{{ filterFileType2.getValueÂ }}" {% if filterFileType2.isSelected %}selected="selected"{% endif %}>{{ filterFileType2.getText }}</option>
                            {% endautoescape %}
                        {% endfor %}
                        </select>
                        <input type="submit" value="Rechercher" />
                    </div>
                </div>
            </div>
        </form>
    </div>
    {% include "search_results.html" %}
    <div id="footer">
        <p>FTPVista 3.0 by Magne &amp; Mc2</p>
    </div>
</body>
</html>
